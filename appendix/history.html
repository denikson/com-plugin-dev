<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Brief history into Unity modding - COM Code Modding</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../chapters/1_plugin_basics/intro.html"><strong aria-hidden="true">1.</strong> Baby's first plugin</a></li><li><ol class="section"><li class="chapter-item expanded "><strong aria-hidden="true">1.1.</strong> Installing tools</li><li class="chapter-item expanded "><strong aria-hidden="true">1.2.</strong> Setting up project</li><li class="chapter-item expanded "><strong aria-hidden="true">1.3.</strong> Logging</li><li class="chapter-item expanded "><strong aria-hidden="true">1.4.</strong> Configuration</li><li class="chapter-item expanded "><strong aria-hidden="true">1.5.</strong> Releasing plugins</li></ol></li><li class="chapter-item expanded "><strong aria-hidden="true">2.</strong> Game code manipulation</li><li><ol class="section"><li class="chapter-item expanded "><strong aria-hidden="true">2.1.</strong> Using dnSpy</li><li class="chapter-item expanded "><strong aria-hidden="true">2.2.</strong> Basics of Harmony</li></ol></li><li class="chapter-item expanded "><strong aria-hidden="true">3.</strong> IL</li><li><ol class="section"><li class="chapter-item expanded "><strong aria-hidden="true">3.1.</strong> How your C# code gets run</li><li class="chapter-item expanded "><strong aria-hidden="true">3.2.</strong> Writing Harmony transpilers</li></ol></li><li class="chapter-item expanded "><strong aria-hidden="true">4.</strong> MonoMod</li><li><ol class="section"><li class="chapter-item expanded "><strong aria-hidden="true">4.1.</strong> Basic setup</li><li class="chapter-item expanded "><strong aria-hidden="true">4.2.</strong> Making a simple patcher</li></ol></li><li class="chapter-item expanded "><a href="../appendix/history.html" class="active">Brief history into Unity modding</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">COM Code Modding</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/denikson/com-plugin-dev" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#a-brief-history-lesson-on-custom-code-execution" id="a-brief-history-lesson-on-custom-code-execution">A brief history lesson on custom code execution</a></h1>
<blockquote>
<p>Note: This section is not mandatory but might prove interesting
in terms of Unity modding history.</p>
</blockquote>
<p>When Unity modding was at its infancy, custom code execution was achieved
by permanently patching some DLL in the game’s <code>Managed</code> folder. Some 
small piece of code was injected into the game which in turn allowed to load 
other user-made DLLs with the code. One example of such loaders was
<a href="https://github.com/Eusth/IPA">Illusion Plugin Architecture</a> (IPA), which at the time
was heavily used to mod Illusion games. IPA had a simple monolithic
architecture in which all core components were in a single core DLL. 
Actual game code manipulation was done by patching <code>Assembly-CSharp.dll</code> — 
DLL containing game’s core logic — making every single C# inheritable 
and every method <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/virtual"><code>virtual</code></a>.</p>
<p>At the time of CM3D2 release, a new tool named <em>ReiPatcher</em> was released. 
While still patching game’s assemblies permanently, ReiPatcher didn’t
virtualize the whole <code>Assembly-CSharp.dll</code> and instead allowed users to 
write custom patchers using <a href="https://github.com/jbevain/cecil">Mono.Cecil</a> 
library which provides low-level access to .NET assembly internals. 
In addition, ReiPatcher shipped with <em>UnityInjector</em> which was a general 
purpose plugin loader for Unity games. Unlike with IPA, ReiPatcher and 
UnityInjector were highly configurable and modular in design. In addition, 
UnityInjector required plugins to save metadata (plugin name, version, etc) 
using <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/attributes/">C# attributes</a>.
While ReiPatcher was quickly outlived, many of its architectural choices are
still seen in many modern loaders.</p>
<p>A minor segway: at the time of ReiPatcher and Mono.Cecil-based patching, tool to make 
patching easier were developed. Most notably</p>
<ul>
<li><a href="https://github.com/MonoMod/MonoMod">MonoMod</a> — allows to write assembly
patchers without touching any of Cecil. It is still very useful in some
cases. In fact it’s still useful in modern loaders, refer to
<a href="/chapters/4_monomod/intro.html">Chapter 4</a> for the guide.</li>
<li><a href="https://github.com/0xd4d/dnSpy">dnSpy</a> — tool to view and inspect .NET
assemblies. Allows to edit assemblies using C# directly, which lowered 
the entry bar for modding significantly (even though it is still
hardpatching). We will dive into dnSpy in <a href="/chapters/2_patching_basics/1_dnspy.html">Chapter 2.1</a>.</li>
</ul>
<p>An important turning point for CM3D2 modding was introduction of Sybaris.<br />
Sybaris was a single DLL file that required only a drop-in installation into 
CM3D2 folder. In turn, Sybaris allowed to run Mono.Cecil patches <strong>in memory</strong>
without ever permanently modifying any game DLLs. Not only did it solve 
potential problems related to user errors, it also made uninstallation and 
game updating much easier. In addition to adding some other CM3D2-specific 
functionality, the base architecture of Sybaris was identical to ReiPatcher. 
Sybaris also used UnityInjector for actual plugin loading.</p>
<p>Sybaris 2 was released at the time of COM3D2 with only minor updates. Around 
the same time, Koikatsu (a game developer by Illusion) was released and 
<a href="https://github.com/BepInEx/BepInEx">BepInEx</a> was developed as a successor 
to IPA. BepInEx took the best parts of IPA’s installation simplicity,
ReiPatcher’s attribute-based metadata and modularity. A little later, 
modders from COM3D2 and Koikatsu community came together, giving birth to
<a href="https://github.com/NeighTools/UnityDoorstop">UnityDoorstop</a> (formerly also 
known as UnityPrePatcher). UnityDoorstop allowed to inject any C# code into
any Unity game right before Unity runs any of its code. This allowed to 
implement all of Sybaris 2 features directly into BepInEx and iterate on them, 
creating truly unified Unity modding framework. </p>
<p>And here we are today. BepInEx
<a href="https://bepinex.github.io/bepinex_docs/master/articles/index.html">has vast documentation</a>, 
contains clean logging and configuration tools and
<a href="https://bepinex.github.io/bepinex_docs/master/articles/advanced/compatibility.html">allows to load Sybaris patchers and UnityInjector plugins</a>
while doing it all in memory.
BepInEx also includes a panoply of helper libraries such as</p>
<ul>
<li><a href="https://harmony.pardeike.net/">Harmony</a> which allows to patch game code at runtime</li>
<li><a href="https://github.com/MonoMod/MonoMod/blob/master/README-RuntimeDetour.md">MonoMod.RuntimeDetour</a> which has a bunch of additional patchers and helper tools</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../chapters/1_plugin_basics/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../chapters/1_plugin_basics/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
